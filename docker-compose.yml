version: '3'
services:
  nginx:
   image: 'nginx:alpine'
   container_name: 'api_gateway'
   depends_on:
      - api_customer
      - api_book
   volumes:
      - ./gateway/default.conf:/etc/nginx/conf.d/default.conf
      - ./gateway/index.html:/usr/share/nginx/html/index.html
   ports:
      - '80:80'
   networks:
      - proxy
  api_customer:    
    container_name: 'api_customer'
    build: 
      context: ./customer/
    image: api_customer:latest
    ports:
      - '8000:8000'
    networks:
      - proxy
  api_book: # Golang REST service
    container_name: 'api_book'    
    build: 
      context: ./book/api_book/api/
    image: api_book:latest
    depends_on: 
      - go_db
    ports: 
      - '8001:8001' 
    networks:
      - proxy
      - db 
  go_db: 
    image: 'postgres:alpine' 
    container_name: 'go_db' 
    ports: 
      - '5432' 
    environment: 
      - POSTGRES_USER=docker 
      - POSTGRES_PASSWORD=docker 
    networks: 
      - db 
networks:
  proxy:
  db: